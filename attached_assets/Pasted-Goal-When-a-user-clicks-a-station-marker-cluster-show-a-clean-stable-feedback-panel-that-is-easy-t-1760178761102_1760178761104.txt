Goal
When a user clicks a station marker/cluster, show a clean, stable feedback panel that is easy to read and submit. The map must not jump, resize, or re-center because of this UI.

Scope constraints (do NOT change these):

❌ No map logic (Leaflet) changes: keep layers, clustering, heatmap, council exactly as-is.

❌ No API shape/endpoint changes. Use the current submit path/handler as-is.

❌ No env, build, or data-fetch changes.

✅ Only adjust the feedback UI/markup/styles/behavior and its open/close handling.

UX behaviors

Open / close

Clicking a station marker opens the Feedback Panel.

Provide both a Close (×) button and a Cancel button. Pressing Esc also closes it.

Do not re-center the map when opening/closing. Do not auto-pan.

Layout

Desktop (≥ 1024px): Panel appears as a fixed right-side drawer, width 380px, full height, shadowed, with an internal scroll if content overflows.

Mobile (< 1024px): Panel appears as a bottom sheet, max-height 70vh, rounded top, drag-to-close via a top grabber + the close (×). Internal scroll for content.

The map remains fully visible behind/alongside the panel.

Content (in this order)

Header row

Station name (bold, 18–20px)

Close (×) icon button (top-right, large hit area)

Meta (small, muted)

Address (1 line, truncate with tooltip/title)

“Connectors: N” (if available)

Feedback controls

Label: “How was this station?”

Two buttons (radio-like): Good / Bad (mutually exclusive, clearly selected state).

Optional comment textarea (3–5 lines, placeholder: “Any details? e.g., broken connector, blocked bay, pricing issue.”)

Actions

Submit feedback (primary)

Cancel (secondary, closes without changes)

Get directions link/button (opens in new tab; keep current logic)

Status

Show a small, inline success toast/snackbar: “Thanks for your feedback.”

On error, show an inline error: “Couldn’t submit. Please try again.”

Interaction & A11y

Trap focus inside panel while open; return focus to the clicked marker on close.

Keyboard: Tab order sensible; Enter activates primary; Esc closes.

All actionable elements have ARIA labels; the panel has role="dialog" with aria-modal="true" and a unique aria-labelledby pointing to the station name.

Visual

Spacing: 16px grid (padding 16–24px).

Typography: Clear hierarchy; avoid text wrapping overflow.

Buttons: consistent sizes; clear selected state for Good/Bad.

Use existing design tokens/utilities (Tailwind or your current CSS modules) — no new libraries.

Technical notes

Reuse the existing station click handler; instead of rendering the old inline popup, mount a <FeedbackPanel /> component and pass the selected station data.

Keep the panel’s state in the existing page (e.g., selectedStation, isFeedbackOpen).

The panel should render in a portal/root-level container so it doesn’t interfere with the map’s DOM (e.g., createPortal to #portal-root), but do not change map containers.

Submissions: call the existing submit function/endpoint. Do not change its request/response schema. If no endpoint exists, just keep current behavior (no-op or the existing stub).

Make sure the panel’s container has pointer-events: auto and the map remains interactive outside the panel.

Acceptance checklist

 Clicking any station opens the organized panel; map position doesn’t shift.

 Desktop = right drawer; Mobile = bottom sheet. Internal scroll, no page scroll-jumps.

 Clear Good/Bad selection, comment textarea, Submit/Cancel, Get directions.

 Close works by ×, Cancel, clicking backdrop (mobile), and Esc.

 Focus is trapped inside the panel; returns to the marker on close.

 Submit shows success toast; network failure shows inline error; no console errors.

 No changes to heatmap, markers, council overlays, or API payloads.

 Lighthouse mobile/desktop: no new a11y or best-practice regressions.

Optional style tokens (if using Tailwind)

Wrapper (desktop): fixed top-0 right-0 h-dvh w-[380px] bg-white shadow-2xl border-l border-gray-200 p-4 overflow-y-auto z-50

Wrapper (mobile sheet): fixed inset-x-0 bottom-0 max-h-[70vh] bg-white rounded-t-2xl shadow-2xl p-4 overflow-y-auto z-50

Header: flex items-start justify-between gap-3 mb-3

Title: text-lg font-semibold leading-tight

Meta: text-sm text-gray-500 space-y-1

Controls row: mt-3 space-y-3

Good/Bad buttons: inline-flex items-center gap-2 px-3 py-2 rounded-lg border hover:bg-gray-50 aria-selected:bg-blue-50 aria-selected:border-blue-500

Textarea: w-full rounded-md border p-2 text-sm resize-vertical

Actions: mt-4 flex items-center gap-3

Primary: px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50

Secondary: px-4 py-2 rounded-md border

Do not modify anything outside this feedback UI and its open/close wiring.