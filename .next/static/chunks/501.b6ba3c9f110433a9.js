(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[501],{4501:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return A}});var r,l,o,u,a,i,c=t(7437),s=t(2265);let d=(0,s.createContext)(null),f=d.Provider;function p(){let e=(0,s.useContext)(d);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var v=t(7691);function m(){return(m=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}let g=(0,s.forwardRef)(function({bounds:e,boundsOptions:n,center:t,children:r,className:l,id:o,placeholder:u,style:a,whenReady:i,zoom:c,...d},p){let[g]=(0,s.useState)({className:l,id:o,style:a}),[h,b]=(0,s.useState)(null);(0,s.useImperativeHandle)(p,()=>h?.map??null,[h]);let y=(0,s.useCallback)(r=>{if(null!==r&&null===h){let l=new v.Map(r,d);null!=t&&null!=c?l.setView(t,c):null!=e&&l.fitBounds(e,n),null!=i&&l.whenReady(i),b(Object.freeze({__version:1,map:l}))}},[]);(0,s.useEffect)(()=>()=>{h?.map.remove()},[h]);let x=h?s.createElement(f,{value:h},r):u??null;return s.createElement("div",m({},g,{ref:y}),x)});var h=t(4887);function b(e,n,t){return Object.freeze({instance:e,context:n,container:t})}function y(e,n){return null==n?function(n,t){let r=(0,s.useRef)();return r.current||(r.current=e(n,t)),r}:function(t,r){let l=(0,s.useRef)();l.current||(l.current=e(t,r));let o=(0,s.useRef)(t),{instance:u}=l.current;return(0,s.useEffect)(function(){o.current!==t&&(n(u,t,o.current),o.current=t)},[u,t,r]),l}}function x(e,n){let t=(0,s.useRef)(n);(0,s.useEffect)(function(){n!==t.current&&null!=e.attributionControl&&(null!=t.current&&e.attributionControl.removeAttribution(t.current),null!=n&&e.attributionControl.addAttribution(n)),t.current=n},[e,n])}function w(e,n){let t=(0,s.useRef)();(0,s.useEffect)(function(){return null!=n&&e.instance.on(n),t.current=n,function(){null!=t.current&&e.instance.off(t.current),t.current=null}},[e,n])}function j(e,n){let t=e.pane??n.pane;return t?{...e,pane:t}:e}function I(e){return function(n){var t;let r=p(),l=e(j(n,r),r);return x(r.map,n.attribution),w(l.current,n.eventHandlers),t=l.current,(0,s.useEffect)(function(){return(r.layerContainer??r.map).addLayer(t.instance),function(){r.layerContainer?.removeLayer(t.instance),r.map.removeLayer(t.instance)}},[r,t]),l}}let C=(r=I(y(function({url:e,...n},t){return b(new v.TileLayer(e,j(n,t)),t)},function(e,n,t){!function(e,n,t){let{opacity:r,zIndex:l}=n;null!=r&&r!==t.opacity&&e.setOpacity(r),null!=l&&l!==t.zIndex&&e.setZIndex(l)}(e,n,t);let{url:r}=n;null!=r&&r!==t.url&&e.setUrl(r)})),(0,s.forwardRef)(function(e,n){let{instance:t}=r(e).current;return(0,s.useImperativeHandle)(n,()=>t),null})),E=(l=I(y(function({position:e,...n},t){var r;let l=new v.Marker(e,n);return b(l,(r={overlayContainer:l},Object.freeze({...t,...r})))},function(e,n,t){n.position!==t.position&&e.setLatLng(n.position),null!=n.icon&&n.icon!==t.icon&&e.setIcon(n.icon),null!=n.zIndexOffset&&n.zIndexOffset!==t.zIndexOffset&&e.setZIndexOffset(n.zIndexOffset),null!=n.opacity&&n.opacity!==t.opacity&&e.setOpacity(n.opacity),null!=e.dragging&&n.draggable!==t.draggable&&(!0===n.draggable?e.dragging.enable():e.dragging.disable())})),(0,s.forwardRef)(function(e,n){let{instance:t,context:r}=l(e).current;return(0,s.useImperativeHandle)(n,()=>t),null==e.children?null:s.createElement(f,{value:r},e.children)})),L=(o=function(e,n){return b(new v.Popup(e,n.overlayContainer),n)},u=function(e,n,{position:t},r){(0,s.useEffect)(function(){let{instance:l}=e;function o(e){e.popup===l&&(l.update(),r(!0))}function u(e){e.popup===l&&r(!1)}return n.map.on({popupopen:o,popupclose:u}),null==n.overlayContainer?(null!=t&&l.setLatLng(t),l.openOn(n.map)):n.overlayContainer.bindPopup(l),function(){n.map.off({popupopen:o,popupclose:u}),n.overlayContainer?.unbindPopup(),n.map.removeLayer(l)}},[e,n,r,t])},a=y(o),i=function(e,n){let t=p(),r=a(j(e,t),t);return x(t.map,e.attribution),w(r.current,e.eventHandlers),u(r.current,t,e,n),r},(0,s.forwardRef)(function(e,n){let[t,r]=(0,s.useState)(!1),{instance:l}=i(e,r).current;(0,s.useImperativeHandle)(n,()=>l),(0,s.useEffect)(function(){t&&l.update()},[l,t,e.children]);let o=l._contentNode;return o?(0,h.createPortal)(e.children,o):null}));function O(e){let{points:n}=e,r=p().map,l=(0,s.useRef)(null);return(0,s.useEffect)(()=>{let e=!1;return(async()=>{let o=(await Promise.resolve().then(t.t.bind(t,7691,23))).default;if(await t.e(684).then(t.t.bind(t,6684,23)),e||!r)return;if(l.current){try{r.removeLayer(l.current)}catch(e){}l.current=null}if(!n.length)return;let u=o.heatLayer(n,{radius:45,blur:25,maxZoom:17,max:1,minOpacity:.35});u.addTo(r),l.current=u})(),()=>{if(e=!0,l.current&&r){try{r.removeLayer(l.current)}catch(e){}l.current=null}}},[r,n]),null}t(966);var S=t(357);async function R(e,n){let t=await fetch(e,{signal:n,cache:"no-store"});if(!t.ok){let n=await t.text().catch(()=>"");throw Error("HTTP ".concat(t.status," ").concat(e,"\n").concat(n))}return t.json()}function k(e){let{onData:n,extraParams:t,debounceMs:r=200}=e,l=p().map,o=(0,s.useRef)(null),u=(0,s.useRef)(null),a=(0,s.useCallback)(()=>{let e=l.getBounds(),r=e.getSouthWest(),u=e.getNorthEast();o.current&&o.current.abort();let a=new AbortController;o.current=a;let i=new URLSearchParams({west:String(r.lng),south:String(r.lat),east:String(u.lng),north:String(u.lat),...t?Object.fromEntries(Object.entries(t).map(e=>{let[n,t]=e;return[n,String(t)]})):{}}),c=S.env.NEXT_PUBLIC_STATIONS_URL||"/api/stations";R("".concat(c,"?").concat(i.toString()),a.signal).then(e=>{var t;n((Array.isArray(e)?e:null!==(t=e.items)&&void 0!==t?t:[]).map(e=>{var n,t,r,l,o,u,a,i,c,s,d,f,p,v,m,g,h,b,y,x,w,j,I,C;return{id:null!==(f=null!==(c=e.id)&&void 0!==c?c:e.ID)&&void 0!==f?f:"".concat(null!==(s=e.lat)&&void 0!==s?s:null===(n=e.AddressInfo)||void 0===n?void 0:n.Latitude,",").concat(null!==(d=e.lng)&&void 0!==d?d:null===(t=e.AddressInfo)||void 0===t?void 0:t.Longitude),lat:null!==(p=e.lat)&&void 0!==p?p:null===(r=e.AddressInfo)||void 0===r?void 0:r.Latitude,lng:null!==(v=e.lng)&&void 0!==v?v:null===(l=e.AddressInfo)||void 0===l?void 0:l.Longitude,name:null!==(g=null!==(m=e.name)&&void 0!==m?m:null===(o=e.AddressInfo)||void 0===o?void 0:o.Title)&&void 0!==g?g:null,addr:null!==(b=null!==(h=e.addr)&&void 0!==h?h:null===(u=e.AddressInfo)||void 0===u?void 0:u.AddressLine1)&&void 0!==b?b:null,postcode:null!==(x=null!==(y=e.postcode)&&void 0!==y?y:null===(a=e.AddressInfo)||void 0===a?void 0:a.Postcode)&&void 0!==x?x:null,powerKW:null!==(j=null!==(w=e.powerKW)&&void 0!==w?w:e.PowerKW)&&void 0!==j?j:void 0,connectors:null!==(C=null!==(I=e.connectors)&&void 0!==I?I:null===(i=e.Connections)||void 0===i?void 0:i.length)&&void 0!==C?C:void 0}}).filter(e=>"number"==typeof e.lat&&"number"==typeof e.lng))}).catch(e=>{(null==e?void 0:e.name)!=="AbortError"&&(console.error("stations fetch failed:",e),n([]))})},[l,n,t]);return(0,s.useEffect)(()=>{let e=()=>{u.current&&window.clearTimeout(u.current),u.current=window.setTimeout(a,r)};return a(),l.on("moveend",e),l.on("zoomend",e),()=>{l.off("moveend",e),l.off("zoomend",e),u.current&&window.clearTimeout(u.current),o.current&&o.current.abort()}},[l,a,r]),null}function A(e){let{center:n,zoom:r,tileUrl:l}=e,[o,u]=(0,s.useState)([]),[a,i]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{let e=await Promise.resolve().then(t.t.bind(t,7691,23)),n=e.Icon.Default.prototype;n&&n._getIconUrl&&delete n._getIconUrl,e.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"})})()},[]);let d=(0,s.useMemo)(()=>o.map(e=>[e.lat,e.lng,1]),[o]);return(0,c.jsxs)("div",{className:"relative w-full h-full",children:[(0,c.jsxs)("div",{className:"absolute z-[1000] right-3 top-3 bg-white/90 rounded-xl shadow p-2 flex items-center gap-3",children:[(0,c.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,c.jsx)("input",{type:"checkbox",checked:a,onChange:()=>i(e=>!e)}),a?"Heatmap":"Markers"]}),(0,c.jsxs)("span",{className:"text-xs text-gray-700",children:["stations: ",o.length]})]}),(0,c.jsxs)(g,{center:n,zoom:r,style:{height:"100%",width:"100%"},children:[(0,c.jsx)(C,{attribution:"\xa9 OpenStreetMap contributors",url:l}),(0,c.jsx)(k,{onData:u}),a?(0,c.jsx)(O,{points:d}):o.map(e=>{var n,t;return(0,c.jsx)(E,{position:[e.lat,e.lng],children:(0,c.jsx)(L,{children:(0,c.jsxs)("div",{style:{minWidth:200},children:[(0,c.jsx)("strong",{children:e.name||"Charging location"}),(0,c.jsx)("div",{children:e.addr||e.postcode||"â€”"}),(0,c.jsxs)("div",{style:{marginTop:6,fontSize:12,opacity:.8},children:["Connectors: ",null!==(n=e.connectors)&&void 0!==n?n:"n/a"," \xb7 Power: ",null!==(t=e.powerKW)&&void 0!==t?t:"n/a"," kW"]})]})})},String(e.id))})]})]})}},966:function(){}}]);