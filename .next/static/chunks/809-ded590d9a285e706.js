"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[809],{7809:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});var o=n(7437),l=n(2265),r=n(551),a=n.n(r),i=n(556);let s=a()(()=>Promise.all([n.e(212),n.e(376)]).then(n.bind(n,1376)).then(e=>e.MapContainer),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),u=a()(()=>Promise.all([n.e(212),n.e(376)]).then(n.bind(n,1376)).then(e=>e.TileLayer),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),d=a()(()=>Promise.all([n.e(212),n.e(376)]).then(n.bind(n,1376)).then(e=>e.CircleMarker),{loadableGenerated:{webpack:()=>[1376]},ssr:!1}),c=a()(()=>Promise.all([n.e(212),n.e(376)]).then(n.bind(n,1376)).then(e=>e.Popup),{loadableGenerated:{webpack:()=>[1376]},ssr:!1});function f(e){var t,n,o,l,r,a,i,s,u;let d=null==e?void 0:null===(t=e.AddressInfo)||void 0===t?void 0:t.Latitude,c=null==e?void 0:null===(n=e.AddressInfo)||void 0===n?void 0:n.Longitude;if("number"!=typeof d||"number"!=typeof c)return null;let f=Array.isArray(null==e?void 0:e.Connections)?e.Connections:[],h=f.length,m=f.reduce((e,t)=>"number"==typeof(null==t?void 0:t.PowerKW)&&t.PowerKW>e?t.PowerKW:e,0)||0,p=null==e?void 0:null===(o=e.autodun)||void 0===o?void 0:o.score;return{lat:d,lon:c,name:null!==(i=null==e?void 0:null===(l=e.AddressInfo)||void 0===l?void 0:l.Title)&&void 0!==i?i:null,addr:null!==(s=null==e?void 0:null===(r=e.AddressInfo)||void 0===r?void 0:r.AddressLine1)&&void 0!==s?s:null,postcode:null!==(u=null==e?void 0:null===(a=e.AddressInfo)||void 0===a?void 0:a.Postcode)&&void 0!==u?u:null,connectors:h,maxPowerKw:m,score:"number"==typeof p?p:.6*Math.log(1+(h||0))+m/350*.3+.1,raw:e}}let h=e=>{let{onReady:t}=e,n=(0,i.Sx)();return(0,l.useEffect)(()=>{t(n)},[n,t]),null},m=e=>{let{onLocate:t}=e,[n,r]=(0,l.useState)(""),[a,i]=(0,l.useState)(!1),s=async()=>{if(n.trim()){i(!0);try{let e=new URL("https://nominatim.openstreetmap.org/search");e.searchParams.set("format","json"),e.searchParams.set("q",n),e.searchParams.set("addressdetails","1"),e.searchParams.set("limit","1"),e.searchParams.set("countrycodes","gb");let o=await fetch(e.toString(),{headers:{Accept:"application/json"}}),l=await o.json();if(null==l?void 0:l.length){let e=l[0],n=parseFloat(e.lat),o=parseFloat(e.lon);t({lat:n,lng:o},13)}else alert("No results for that place/postcode.")}catch(e){console.error(e),alert("Search failed. Try again.")}finally{i(!1)}}};return(0,o.jsxs)("div",{className:"z-[1000] absolute top-4 left-4 bg-black/80 text-white rounded-xl px-3 py-3 flex flex-wrap items-center gap-2",children:[(0,o.jsx)("button",{onClick:()=>t(null),className:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20",children:"My location"}),(0,o.jsx)("button",{onClick:()=>window.location.reload(),className:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20",children:"Reset view"}),(0,o.jsx)("button",{id:"markersBtn",className:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20",children:"Markers"}),(0,o.jsx)("button",{id:"heatBtn",className:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20",children:"Heatmap"}),(0,o.jsx)("input",{value:n,onChange:e=>r(e.target.value),placeholder:"Search postcode or area (e.g. EC1A)",className:"px-3 py-2 rounded-lg bg-white/10 outline-none w-80"}),(0,o.jsx)("button",{onClick:s,disabled:a,className:"px-3 py-2 rounded-lg bg-emerald-500 text-black hover:bg-emerald-400",children:a?"Searchingâ€¦":"Search"})]})},p=e=>{let{setStations:t,setHeatData:n,zoom:o,showMarkers:r,showHeat:a,onToggleWires:s}=e,u=(0,i.Sx)(),d=function(e,t){let n=(0,l.useRef)(null);return function(){for(var o=arguments.length,l=Array(o),r=0;r<o;r++)l[r]=arguments[r];n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(()=>e(...l),t)}}(async()=>{let e=u.getCenter(),l=Math.max(2,Math.min(25,Math.round(function(e){let t=e.getSouthWest(),n=e.getNorthEast(),o=(n.lat-t.lat)*Math.PI/180,l=(n.lng-t.lng)*Math.PI/180,r=Math.sin(o/2)**2+Math.cos(t.lat*Math.PI/180)*Math.cos(n.lat*Math.PI/180)*Math.sin(l/2)**2;return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371/2}(u.getBounds()))));if(o>=13&&r){let n="/api/stations?lat=".concat(e.lat.toFixed(5),"&lon=").concat(e.lng.toFixed(5),"&radiusKm=").concat(l),o=await fetch(n,{cache:"no-store"}),r=await o.json();t((Array.isArray(r)?r:[]).map(f).filter(Boolean))}else t([]);if(a){let t="/api/heatmap?lat=".concat(e.lat.toFixed(5),"&lon=").concat(e.lng.toFixed(5),"&radiusKm=").concat(l),o=await fetch(t,{cache:"no-store"}),r=await o.json();n(Array.isArray(r)?r:[])}else n([])},350);return(0,l.useEffect)(()=>{let e=()=>d();return u.on("moveend",e),u.on("zoomend",e),d(),s({attach:()=>{u.on("moveend",e),u.on("zoomend",e)},detach:()=>{u.off("moveend",e),u.off("zoomend",e)}}),()=>{u.off("moveend",e),u.off("zoomend",e)}},[u,o,r,a]),null};var g=()=>{let[e,t]=(0,l.useState)([]),[r,a]=(0,l.useState)([]),[i,f]=(0,l.useState)(!0),[g,v]=(0,l.useState)(!1),[x,b]=(0,l.useState)([51.5072,-.1276]),[y,w]=(0,l.useState)(12),[j,P]=(0,l.useState)(null),[M,C]=(0,l.useState)(!1),S=(0,l.useRef)(null),k=(0,l.useRef)(null),_=(0,l.useRef)(null),E=(0,l.useRef)(null),z=async e=>{var t,o;k.current=e;let l=await n.e(212).then(n.t.bind(n,7691,23));await n.e(684).then(n.t.bind(n,6684,23)),_.current=l,e.getPane("overlay-councils")||(e.createPane("overlay-councils"),e.getPane("overlay-councils").style.zIndex=300),e.getPane("heatmap")||(e.createPane("heatmap"),e.getPane("heatmap").style.zIndex=350),e.on("zoomend",()=>{w(e.getZoom()),C(13>e.getZoom())}),e.on("moveend",()=>{let t=e.getCenter();b([t.lat,t.lng])}),w(e.getZoom()),C(13>e.getZoom()),b([e.getCenter().lat,e.getCenter().lng]),null===(t=document.getElementById("markersBtn"))||void 0===t||t.addEventListener("click",()=>f(e=>!e)),null===(o=document.getElementById("heatBtn"))||void 0===o||o.addEventListener("click",()=>v(e=>!e))},O=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:14,n=k.current;n&&(e?(n.setView([e.lat,e.lng],Math.max(t,14)),P(e),E.current&&clearTimeout(E.current),E.current=setTimeout(()=>P(null),6e3)):navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>n.setView([e.coords.latitude,e.coords.longitude],13),()=>alert("Location permission denied")))};(0,l.useEffect)(()=>()=>{E.current&&clearTimeout(E.current)},[]);let A=(0,l.useMemo)(()=>i&&y>=13?e:[],[i,e,y]);return(0,o.jsxs)("div",{className:"w-full h-[calc(100vh-64px)] relative",children:[(0,o.jsx)(m,{onLocate:O}),M&&(0,o.jsx)("div",{className:"absolute top-24 left-1/2 -translate-x-1/2 bg-black/80 text-white px-4 py-2 rounded-xl z-[1000] text-sm shadow",children:"Zoom in to see markers"}),(0,o.jsxs)(s,{center:x,zoom:y,style:{height:"100%",width:"100%"},whenCreated:e=>z(e),children:[(0,o.jsx)(h,{onReady:z}),(0,o.jsx)(u,{attribution:"\xa9 OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,o.jsx)(p,{setStations:t,setHeatData:a,zoom:y,showMarkers:i,showHeat:g,onToggleWires:e=>S.current=e}),A.map((e,t)=>{var n,l,r,a,i,s;return(0,o.jsx)(d,{center:[e.lat,e.lon],radius:6,fillOpacity:.85,children:(0,o.jsx)(c,{children:(0,o.jsxs)("div",{style:{minWidth:220},children:[(0,o.jsx)("b",{children:null!==(n=e.name)&&void 0!==n?n:"Charging site"}),(0,o.jsx)("div",{children:null!==(r=null!==(l=e.postcode)&&void 0!==l?l:e.addr)&&void 0!==r?r:""}),(0,o.jsxs)("div",{children:["Max power: ",null!==(a=e.maxPowerKw)&&void 0!==a?a:0," kW"]}),(0,o.jsxs)("div",{children:["Connectors: ",null!==(i=e.connectors)&&void 0!==i?i:0]}),(0,o.jsxs)("div",{children:["Score: ",(null!==(s=e.score)&&void 0!==s?s:0).toFixed(2)]}),(0,o.jsx)("i",{children:"Feedback coming soon"})]})})},"".concat(e.lat,",").concat(e.lon,",").concat(t))}),j&&(0,o.jsx)(d,{center:[j.lat,j.lng],radius:10,fillOpacity:.7,color:"#00f"})]})]})}},551:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r}});let o=n(9920);n(7437),n(2265);let l=o._(n(148));function r(e,t){var n;let o={loading:e=>{let{error:t,isLoading:n,pastDelay:o}=e;return null}};"function"==typeof e&&(o.loader=e);let r={...o,...t};return(0,l.default)({...r,modules:null==(n=r.loadableGenerated)?void 0:n.modules})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},912:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"BailoutToCSR",{enumerable:!0,get:function(){return l}});let o=n(5592);function l(e){let{reason:t,children:n}=e;if("undefined"==typeof window)throw new o.BailoutToCSRError(t);return n}},148:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return u}});let o=n(7437),l=n(2265),r=n(912),a=n(1481);function i(e){return{default:e&&"default"in e?e.default:e}}let s={loader:()=>Promise.resolve(i(()=>null)),loading:null,ssr:!0},u=function(e){let t={...s,...e},n=(0,l.lazy)(()=>t.loader().then(i)),u=t.loading;function d(e){let i=u?(0,o.jsx)(u,{isLoading:!0,pastDelay:!0,error:null}):null,s=t.ssr?(0,o.jsxs)(o.Fragment,{children:["undefined"==typeof window?(0,o.jsx)(a.PreloadCss,{moduleIds:t.modules}):null,(0,o.jsx)(n,{...e})]}):(0,o.jsx)(r.BailoutToCSR,{reason:"next/dynamic",children:(0,o.jsx)(n,{...e})});return(0,o.jsx)(l.Suspense,{fallback:i,children:s})}return d.displayName="LoadableComponent",d}},1481:function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"PreloadCss",{enumerable:!0,get:function(){return r}});let o=n(7437),l=n(8512);function r(e){let{moduleIds:t}=e;if("undefined"!=typeof window)return null;let n=(0,l.getExpectedRequestStore)("next/dynamic css"),r=[];if(n.reactLoadableManifest&&t){let e=n.reactLoadableManifest;for(let n of t){if(!e[n])continue;let t=e[n].files.filter(e=>e.endsWith(".css"));r.push(...t)}}return 0===r.length?null:(0,o.jsx)(o.Fragment,{children:r.map(e=>(0,o.jsx)("link",{precedence:"dynamic",rel:"stylesheet",href:n.assetPrefix+"/_next/"+encodeURI(e),as:"style"},e))})}},670:function(e,t,n){n.d(t,{Hb:function(){return l},UO:function(){return i},mE:function(){return s},sj:function(){return r}});var o=n(2265);function l(e){return Object.freeze({__version:1,map:e})}function r(e,t){return Object.freeze({...e,...t})}let a=(0,o.createContext)(null),i=a.Provider;function s(){let e=(0,o.useContext)(a);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}},556:function(e,t,n){n.d(t,{$_:function(){return a},Sx:function(){return r},zV:function(){return i}});var o=n(670),l=n(2265);function r(){return(0,o.mE)().map}function a(e,t){let n=r();return(0,l.useEffect)(function(){return n.on(e,t),function(){n.off(e,t)}},[n,e,t]),n}function i(e){let t=r();return(0,l.useEffect)(function(){return t.on(e),function(){t.off(e)}},[t,e]),t}}}]);