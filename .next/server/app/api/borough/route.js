"use strict";(()=>{var e={};e.id=640,e.ids=[640],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3292:e=>{e.exports=require("fs/promises")},7042:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>h,patchFetch:()=>m,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var n={};o.r(n),o.d(n,{GET:()=>c,dynamic:()=>i});var r=o(9303),a=o(8716),s=o(3131);let i="force-dynamic",u=(e,t=0)=>{let o=Number(e);return Number.isFinite(o)?o:t};async function c(e){try{let e=globalThis;if(!e.__councilStationsCache){let{readFile:t}=await Promise.resolve().then(o.t.bind(o,3292,23)),n=process.cwd()+"/data/councilStations.json",r=await t(n,"utf-8");e.__councilStationsCache=JSON.parse(r)}let n=e.__councilStationsCache;if(!e.__evRegistrationsCache){let{readFile:t}=await Promise.resolve().then(o.t.bind(o,3292,23)),n=process.cwd()+"/data/boroughEVRegistrations.json",r=await t(n,"utf-8");e.__evRegistrationsCache=JSON.parse(r)}let r=e.__evRegistrationsCache,a=new URLSearchParams({output:"json",countrycode:"GB",latitude:String(53.5),longitude:String(-1.5),distance:String(500),distanceunit:"KM",maxresults:"5000",compact:"false",verbose:"true",includecomments:"false"}),s=process.env.OPENCHARGEMAP_API_KEY||process.env.OCM_API_KEY;s&&a.set("key",String(s));let i=`https://api.openchargemap.io/v3/poi/?${a.toString()}`,c=await fetch(i,{headers:{Accept:"application/json","User-Agent":"Autodun-EV-Finder/1.0 (contact: info@autodun.com)"},cache:"no-store"}),p=await c.json().catch(()=>[]),l=Array.isArray(p)?p:[],d={};function t(e,t){e&&(d[e]||(d[e]={borough:e,connectorCount:0}),d[e].connectorCount+=t)}for(let e of l){let o=e?.AddressInfo??{},n=o?.Town,r=o?.Postcode,a="";n?a=n.trim():r&&(a=r.split(/\s+/)[0]);let s=Array.isArray(e?.Connections)?e.Connections.length:0;t(a,s)}for(let e of n){let o=e?.Borough,n=Array.isArray(e?.Connections)?e.Connections.length:0;t(o,n)}let g=Object.values(d).map(e=>{let t=u(r[e.borough],0),o=e.connectorCount;return{borough:e.borough,stationCount:o,connectorCount:o,evRegistrations:t,gapIndex:o>0?t/o:null}}).filter(e=>e.evRegistrations&&null!==e.gapIndex);return g.sort((e,t)=>null===e.gapIndex&&null===t.gapIndex?0:null===e.gapIndex?1:null===t.gapIndex?-1:t.gapIndex-e.gapIndex),new Response(JSON.stringify(g),{status:200,headers:{"content-type":"application/json"}})}catch(e){return console.error(e),new Response(JSON.stringify([]),{status:200,headers:{"content-type":"application/json"}})}}let p=new r.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/borough/route",pathname:"/api/borough",filename:"route",bundlePath:"app/api/borough/route"},resolvedPagePath:"/workspaces/autodun-ev-finder/app/api/borough/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:d,serverHooks:g}=p,h="/api/borough/route";function m(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},9303:(e,t,o)=>{e.exports=o(517)}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),n=t.X(0,[948],()=>o(7042));module.exports=n})();